# License Server - ĞŸĞ»Ğ°Ğ½ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

## ĞĞ±Ğ·Ğ¾Ñ€

ĞÑ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸ÑĞ¼Ğ¸ SIP Wrapper SaaS.

**Ğ¡Ñ‚ĞµĞº:** PHP Lumen + MySQL
**Ğ ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹:** ĞÑ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ (license-server)

---

## Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ

```
ĞŸĞ°Ñ€Ñ‚Ğ½Ñ‘Ñ€ (Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°) â”€â”€[Ğ¿Ñ€Ğ¾Ğ´Ğ°Ñ‘Ñ‚]â”€â”€> ĞšĞ»Ğ¸ĞµĞ½Ñ‚
         â”‚
         â”‚ Webhook (Ğ·Ğ°ĞºĞ°Ğ·)
         â–¼
   License Server â”€â”€[Ğ²Ñ‹Ğ´Ğ°Ñ‘Ñ‚ ĞºĞ»ÑÑ‡]â”€â”€> ĞšĞ»Ğ¸ĞµĞ½Ñ‚
         â”‚
         â”‚ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°
         â–¼
   SIP Wrapper (Ñƒ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°)
```

**ĞŸĞ°Ñ€Ñ‚Ğ½Ñ‘Ñ€ Ğ±ĞµÑ€Ñ‘Ñ‚ 15%** - Ğ¾Ğ½Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ°ÑÑ‚, Ğ¼Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹.

---

## Ğ¢Ğ°Ñ€Ğ¸Ñ„Ğ½Ñ‹Ğµ Ğ¿Ğ»Ğ°Ğ½Ñ‹

### Ğ¢Ğ¸Ğ¿Ñ‹ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²

| Ğ¢Ğ¸Ğ¿ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | Connections | Ğ¡Ñ€Ğ¾Ğº | Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ Ğ½Ğ° Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ |
|-----|------------|-------------|------|-------------------|
| **Trial** | Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ | 2 | 14 Ğ´Ğ½ĞµĞ¹ | **1** |
| **NFR** | ĞŸĞ°Ñ€Ñ‚Ğ½Ñ‘Ñ€Ñ‹, Ğ´ĞµĞ¼Ğ¾ | 2 | 6-12 Ğ¼ĞµÑ | **1** |
| **Paid** | ĞŸÑ€Ğ¾Ğ´Ğ°ĞºÑˆĞ½ | 10+ | 12/24/36 Ğ¼ĞµÑ | Ğ‘ĞµĞ· Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ° |

**ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ:**
- Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ 1 trial Ğ¿Ğ°ĞºĞµÑ‚ Ğ½Ğ° Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ
- Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ 1 NFR Ğ¿Ğ°ĞºĞµÑ‚ Ğ½Ğ° Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ
- Paid Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ² Ğ±ĞµĞ· Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğ¹ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¿Ğ°Ñ‚ÑŒ)

### Ğ¦ĞµĞ½Ğ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (B2B - Ğ´Ğ»Ñ Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€Ğ¾Ğ²)

**ĞŸĞ°ĞºĞµÑ‚ = 10 ĞºĞ¾Ğ½Ğ½ĞµĞºÑ‚Ğ¾Ñ€Ğ¾Ğ²**

| Ğ¡Ñ€Ğ¾Ğº | Ğ¦ĞµĞ½Ğ°/Ğ¼ĞµÑ | Ğ“Ğ¾Ğ´ | Ğ—Ğ° 1 conn |
|------|----------|-----|-----------|
| 12 Ğ¼ĞµÑ | 149â‚¬ | 1 788â‚¬ | 14.90â‚¬ |
| 24 Ğ¼ĞµÑ | 119â‚¬ | 2 856â‚¬ | 11.90â‚¬ |
| 36 Ğ¼ĞµÑ | 99â‚¬ | 3 564â‚¬ | 9.90â‚¬ |

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²

| Conn | 12 Ğ¼ĞµÑ | 24 Ğ¼ĞµÑ | 36 Ğ¼ĞµÑ |
|------|--------|--------|--------|
| 10 | 149â‚¬/Ğ¼ĞµÑ | 119â‚¬/Ğ¼ĞµÑ | 99â‚¬/Ğ¼ĞµÑ |
| 20 | 298â‚¬/Ğ¼ĞµÑ | 238â‚¬/Ğ¼ĞµÑ | 198â‚¬/Ğ¼ĞµÑ |
| 30 | 447â‚¬/Ğ¼ĞµÑ | 357â‚¬/Ğ¼ĞµÑ | 297â‚¬/Ğ¼ĞµÑ |
| 50 | 745â‚¬/Ğ¼ĞµÑ | 595â‚¬/Ğ¼ĞµÑ | 495â‚¬/Ğ¼ĞµÑ |

### ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶

```
ĞœÑ‹ â†’ ĞŸĞ°Ñ€Ñ‚Ğ½Ñ‘Ñ€ â†’ ĞšĞ¾Ğ½ĞµÑ‡Ğ½Ñ‹Ğ¹ ĞºĞ»Ğ¸ĞµĞ½Ñ‚

ĞŸĞ°Ñ€Ñ‚Ğ½Ñ‘Ñ€ Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°ĞµÑ‚:     10 conn, 36 Ğ¼ĞµÑ = 99â‚¬/Ğ¼ĞµÑ
ĞŸĞ°Ñ€Ñ‚Ğ½Ñ‘Ñ€ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ñ‘Ñ‚:      10 Ã— 20â‚¬ = 200â‚¬/Ğ¼ĞµÑ
ĞœĞ°Ñ€Ğ¶Ğ° Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€Ğ°:       101â‚¬/Ğ¼ĞµÑ (102%)
```

### Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ "Connection"

```
1 Connection = User â†” SIP Wrapper â†” Gateway

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:
VAPI â†” FreeSWITCH â†” Placetel = 1 connection
(inbound + outbound Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹)
```

---

## Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

```
licenses (Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€/ĞºĞ»Ğ¸ĞµĞ½Ñ‚)
    â”‚
    â””â”€â”€ license_packages (Ğ¿Ğ°ĞºĞµÑ‚Ñ‹ - trial/nfr/paid)
            â”‚
            â””â”€â”€ license_checks (Ğ°ÑƒĞ´Ğ¸Ñ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¾Ğº)
```

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `licenses` (Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€/ĞºĞ»Ğ¸ĞµĞ½Ñ‚)

```sql
CREATE TABLE licenses (
    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,

    -- ĞšĞ»ÑÑ‡ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¸ (UUID v4)
    license_key CHAR(36) NOT NULL UNIQUE,

    -- ĞŸĞ°Ñ€Ñ‚Ğ½Ñ‘Ñ€/ĞšĞ»Ğ¸ĞµĞ½Ñ‚
    customer_name VARCHAR(255) NOT NULL,
    customer_email VARCHAR(255) NOT NULL,
    customer_company VARCHAR(255) NULL,

    -- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°
    status ENUM('active', 'suspended', 'cancelled') NOT NULL DEFAULT 'active',

    -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    notes TEXT NULL,

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    INDEX idx_status (status),
    INDEX idx_email (customer_email)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `license_packages` (Ğ¿Ğ°ĞºĞµÑ‚Ñ‹)

```sql
CREATE TABLE license_packages (
    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    license_id INT UNSIGNED NOT NULL,

    -- Ğ¢Ğ¸Ğ¿ Ğ¿Ğ°ĞºĞµÑ‚Ğ°
    type ENUM('trial', 'nfr', 'paid') NOT NULL DEFAULT 'paid',

    -- ĞŸÑ€Ğ¸Ğ²ÑĞ·ĞºĞ° Ğº ÑĞµÑ€Ğ²ĞµÑ€Ñƒ
    server_ip VARCHAR(45) NULL,           -- IPv4 Ğ¸Ğ»Ğ¸ IPv6
    server_hostname VARCHAR(255) NULL,    -- DNS Ğ¸Ğ¼Ñ

    -- Ğ›Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹
    connections SMALLINT UNSIGNED NOT NULL DEFAULT 2,  -- 2 Ğ´Ğ»Ñ trial/nfr, 10+ Ğ´Ğ»Ñ paid

    -- Billing (Ğ´Ğ»Ñ paid)
    billing_cycle ENUM('monthly', 'quarterly', 'yearly') NULL,
    price_cents INT UNSIGNED NOT NULL DEFAULT 0,

    -- Ğ”Ğ°Ñ‚Ñ‹
    starts_at DATETIME NOT NULL,
    expires_at DATETIME NOT NULL,

    -- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
    status ENUM('active', 'suspended', 'expired', 'cancelled') NOT NULL DEFAULT 'active',

    -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    partner_order_id VARCHAR(255) NULL,
    notes TEXT NULL,

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    FOREIGN KEY (license_id) REFERENCES licenses(id) ON DELETE CASCADE,
    INDEX idx_license (license_id),
    INDEX idx_server (server_ip, server_hostname),
    INDEX idx_status (status),
    INDEX idx_expires (expires_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `license_checks` (Ğ°ÑƒĞ´Ğ¸Ñ‚ ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¾Ğº)

```sql
CREATE TABLE license_checks (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    package_id INT UNSIGNED NOT NULL,

    -- Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ
    instance_id CHAR(36) NOT NULL,        -- UUID Ğ¸Ğ½ÑÑ‚Ğ°Ğ»Ğ»ÑÑ†Ğ¸Ğ¸
    ip_address VARCHAR(45) NOT NULL,
    hostname VARCHAR(255) NULL,

    -- Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
    current_connections SMALLINT UNSIGNED NOT NULL DEFAULT 0,

    -- Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
    result ENUM('valid', 'expired', 'suspended', 'over_limit', 'ip_mismatch', 'instance_mismatch') NOT NULL,

    checked_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (package_id) REFERENCES license_packages(id) ON DELETE CASCADE,
    INDEX idx_package_date (package_id, checked_at),
    INDEX idx_instance (instance_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `license_attempts` (Ğ°ÑƒĞ´Ğ¸Ñ‚ Ğ½ĞµÑƒĞ´Ğ°Ñ‡Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº)

```sql
CREATE TABLE license_attempts (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,

    -- Ğ§Ñ‚Ğ¾ Ğ¿Ñ‹Ñ‚Ğ°Ğ»Ğ¸ÑÑŒ
    license_key VARCHAR(36) NULL,         -- ĞœĞ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ½ĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
    instance_id CHAR(36) NULL,

    -- ĞÑ‚ĞºÑƒĞ´Ğ°
    ip_address VARCHAR(45) NOT NULL,
    hostname VARCHAR(255) NULL,
    user_agent VARCHAR(500) NULL,

    -- Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
    result ENUM('invalid_key', 'expired', 'suspended', 'ip_mismatch', 'instance_mismatch', 'rate_limited') NOT NULL,
    error_message VARCHAR(255) NULL,

    attempted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    INDEX idx_ip (ip_address),
    INDEX idx_key (license_key),
    INDEX idx_date (attempted_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°

```
Ğ§Ñ‚Ğ¾ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼:
â”œâ”€â”€ Ğ£ÑĞ¿ĞµÑˆĞ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ â†’ license_checks
â””â”€â”€ ĞĞµÑƒĞ´Ğ°Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸ â†’ license_attempts

Ğ—Ğ°Ñ‡ĞµĞ¼:
â”œâ”€â”€ Ğ”ĞµÑ‚ĞµĞºÑ†Ğ¸Ñ Ğ¿Ğ¸Ñ€Ğ°Ñ‚ÑÑ‚Ğ²Ğ° (Ğ¼Ğ½Ğ¾Ğ³Ğ¾ invalid_key Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ IP)
â”œâ”€â”€ Ğ”ĞµÑ‚ĞµĞºÑ†Ğ¸Ñ ĞºĞ»Ğ¾Ğ½Ğ¾Ğ² (instance_mismatch)
â”œâ”€â”€ ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ² (Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚?)
â””â”€â”€ Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
```

### ĞĞ»ĞµÑ€Ñ‚Ñ‹

```
Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ğ°Ğ»ĞµÑ€Ñ‚Ğ°:
â”œâ”€â”€ >10 invalid_key Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ IP Ğ·Ğ° Ñ‡Ğ°Ñ
â”œâ”€â”€ instance_mismatch Ğ´Ğ»Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ°ĞºĞµÑ‚Ğ°
â”œâ”€â”€ Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ IP Ğ´Ğ»Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ instance Ğ·Ğ° 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
â””â”€â”€ ĞĞµĞ¾Ğ±Ñ‹Ñ‡Ğ½Ğ°Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ
```

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```
License #1: Partner GmbH (LICENSE_KEY: ABC-DEF-123)
â”œâ”€â”€ Package #1: trial, 2 conn, server: test.client.de, 14 Ğ´Ğ½ĞµĞ¹
â”œâ”€â”€ Package #2: nfr, 2 conn, server: demo.partner.de, 12 Ğ¼ĞµÑ
â”œâ”€â”€ Package #3: paid, 10 conn, server: 195.168.1.100, 36 Ğ¼ĞµÑ
â””â”€â”€ Package #4: paid, 10 conn, server: 195.168.1.200, 24 Ğ¼ĞµÑ
```

---

## API Endpoints

### ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ (Ğ´Ğ»Ñ SIP Wrapper)

#### `POST /api/verify`

ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¸ Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ Ğ¸ heartbeat.

**Request:**
```json
{
    "license_key": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
    "current_trunks": 3,
    "hostname": "client-server.example.com"
}
```

**Response (success):**
```json
{
    "valid": true,
    "plan": "business",
    "max_trunks": 10,
    "expires_at": "2025-12-31T23:59:59Z",
    "days_remaining": 180
}
```

**Response (error):**
```json
{
    "valid": false,
    "error": "license_expired",
    "message": "License expired on 2024-01-15"
}
```

**Error codes:**
- `invalid_key` - ĞšĞ»ÑÑ‡ Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚
- `license_expired` - Ğ¡Ñ€Ğ¾Ğº Ğ¸ÑÑ‚Ñ‘Ğº
- `license_suspended` - ĞŸÑ€Ğ¸Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°
- `over_limit` - ĞŸÑ€ĞµĞ²Ñ‹ÑˆĞµĞ½ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ trunks

---

### Webhook (Ğ¾Ñ‚ Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€Ğ°)

#### `POST /webhook/order`

ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¸ Ğ¿Ñ€Ğ¸ Ğ·Ğ°ĞºĞ°Ğ·Ğµ.

**Request:**
```json
{
    "order_id": "PARTNER-12345",
    "customer": {
        "name": "Max Mustermann",
        "email": "max@example.com",
        "company": "Example GmbH"
    },
    "plan": "business",
    "billing_cycle": "yearly",
    "signature": "hmac_sha256_signature"
}
```

**Response:**
```json
{
    "success": true,
    "license_key": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
    "expires_at": "2026-02-05T00:00:00Z"
}
```

**Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ:** HMAC-SHA256 Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ñ shared secret.

---

### Admin API (Ğ·Ğ°Ñ‰Ğ¸Ñ‰Ñ‘Ğ½Ğ½Ñ‹Ğµ)

| Method | Endpoint | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|--------|----------|----------|
| GET | `/admin/licenses` | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¹ |
| GET | `/admin/licenses/{id}` | Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¸ |
| POST | `/admin/licenses` | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ |
| PUT | `/admin/licenses/{id}` | ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ |
| DELETE | `/admin/licenses/{id}` | Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ |
| POST | `/admin/licenses/{id}/suspend` | ĞŸÑ€Ğ¸Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ |
| POST | `/admin/licenses/{id}/activate` | ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ |
| POST | `/admin/licenses/{id}/extend` | ĞŸÑ€Ğ¾Ğ´Ğ»Ğ¸Ñ‚ÑŒ |
| GET | `/admin/licenses/{id}/checks` | Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¾Ğº |
| GET | `/admin/stats` | Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° |

---

## Admin Panel (Web UI)

### Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹

1. **Dashboard**
   - ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¸
   - Ğ˜ÑÑ‚ĞµĞºĞ°ÑÑ‰Ğ¸Ğµ ÑĞºĞ¾Ñ€Ğ¾ (7 Ğ´Ğ½ĞµĞ¹)
   - ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸
   - Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶

2. **Licenses**
   - Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ²ÑĞµÑ… Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¹
   - Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹: ÑÑ‚Ğ°Ñ‚ÑƒÑ, Ğ¿Ğ»Ğ°Ğ½, Ğ´Ğ°Ñ‚Ğ°
   - ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ email/Ğ¸Ğ¼ĞµĞ½Ğ¸
   - Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ

3. **License Detail**
   - Ğ’ÑÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
   - Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¾Ğº
   - Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
   - ĞŸÑ€Ğ¾Ğ´Ğ»ĞµĞ½Ğ¸Ğµ

4. **Create License**
   - Ğ¤Ğ¾Ñ€Ğ¼Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ
   - Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ°
   - Email ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)

5. **Settings**
   - Webhook secret
   - Email Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
   - Ğ¢Ğ°Ñ€Ğ¸Ñ„Ñ‹ (Ñ†ĞµĞ½Ñ‹)

---

## Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Lumen

```
license-server/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Http/
â”‚   â”‚   â”œâ”€â”€ Controllers/
â”‚   â”‚   â”‚   â”œâ”€â”€ Api/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ LicenseController.php
â”‚   â”‚   â”‚   â”œâ”€â”€ Admin/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardController.php
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ LicenseController.php
â”‚   â”‚   â”‚   â””â”€â”€ WebhookController.php
â”‚   â”‚   â””â”€â”€ Middleware/
â”‚   â”‚       â”œâ”€â”€ AdminAuth.php
â”‚   â”‚       â””â”€â”€ WebhookSignature.php
â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â”œâ”€â”€ License.php
â”‚   â”‚   â””â”€â”€ LicenseCheck.php
â”‚   â””â”€â”€ Services/
â”‚       â”œâ”€â”€ LicenseService.php
â”‚       â””â”€â”€ EmailService.php
â”‚
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â”œâ”€â”€ 2024_01_01_create_licenses_table.php
â”‚   â”‚   â””â”€â”€ 2024_01_02_create_license_checks_table.php
â”‚   â””â”€â”€ seeders/
â”‚       â””â”€â”€ PlanSeeder.php
â”‚
â”œâ”€â”€ resources/
â”‚   â””â”€â”€ views/
â”‚       â”œâ”€â”€ layouts/
â”‚       â”‚   â””â”€â”€ admin.blade.php
â”‚       â”œâ”€â”€ admin/
â”‚       â”‚   â”œâ”€â”€ dashboard.blade.php
â”‚       â”‚   â”œâ”€â”€ licenses/
â”‚       â”‚   â”‚   â”œâ”€â”€ index.blade.php
â”‚       â”‚   â”‚   â”œâ”€â”€ show.blade.php
â”‚       â”‚   â”‚   â”œâ”€â”€ create.blade.php
â”‚       â”‚   â”‚   â””â”€â”€ edit.blade.php
â”‚       â”‚   â””â”€â”€ settings.blade.php
â”‚       â””â”€â”€ emails/
â”‚           â””â”€â”€ license-created.blade.php
â”‚
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ web.php
â”‚
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ css/
â”‚   â””â”€â”€ js/
â”‚
â”œâ”€â”€ .env.example
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â””â”€â”€ README.md
```

---

## Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ² SIP Wrapper

### ĞĞ¾Ğ²Ñ‹Ğµ ENV Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ

```bash
# License
LICENSE_KEY=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
LICENSE_SERVER=https://license.example.com

# Optional: offline grace period (default 7 days)
LICENSE_GRACE_DAYS=7
```

### Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸

```python
# Ğ’ admin/app.py Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ license_client.py

import requests
from datetime import datetime, timedelta

class LicenseClient:
    def __init__(self, key, server):
        self.key = key
        self.server = server
        self.cache = None
        self.cache_time = None

    def verify(self, current_trunks=0):
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ"""
        try:
            response = requests.post(
                f"{self.server}/api/verify",
                json={
                    "license_key": self.key,
                    "current_trunks": current_trunks,
                    "hostname": socket.gethostname()
                },
                timeout=10
            )
            data = response.json()

            if data.get("valid"):
                self.cache = data
                self.cache_time = datetime.now()
                return data
            else:
                return {"valid": False, "error": data.get("error")}

        except requests.RequestException:
            # Offline - use cache if within grace period
            if self.cache and self.cache_time:
                grace = timedelta(days=int(os.getenv("LICENSE_GRACE_DAYS", 7)))
                if datetime.now() - self.cache_time < grace:
                    return self.cache
            return {"valid": False, "error": "connection_failed"}

    def can_add_trunk(self, current_count):
        """ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ»Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞµÑ‰Ñ‘ trunk"""
        if not self.cache:
            self.verify(current_count)

        max_trunks = self.cache.get("max_trunks")
        if max_trunks is None:  # unlimited
            return True
        return current_count < max_trunks
```

### Ğ¢Ğ¾Ñ‡ĞºĞ¸ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ² Admin Portal

1. **ĞŸÑ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ** - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ
2. **ĞŸÑ€Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ gateway** - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚
3. **Heartbeat** - Ñ€Ğ°Ğ· Ğ² 24 Ñ‡Ğ°ÑĞ°
4. **Ğ’ UI** - Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¸

---

## Security

### API Key
- UUID v4 (36 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)
- Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ
- ĞĞµ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ÑÑ Ğ² Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¾Ğ¼ Ğ²Ğ¸Ğ´Ğµ Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ…

### Webhook
- HMAC-SHA256 Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ
- Shared secret Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€Ğ¾Ğ¼ Ğ¸ ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ¼
- Timestamp Ğ´Ğ»Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ğ¾Ñ‚ replay

### Admin
- HTTP Basic Auth Ğ¸Ğ»Ğ¸ Session
- HTTPS Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾
- Rate limiting

### SIP Wrapper Client
- HTTPS Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¾Ğº
- Grace period Ğ¿Ñ€Ğ¸ offline
- ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°

---

## Deployment

### Docker Compose

```yaml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "8080:80"
    environment:
      - APP_ENV=production
      - DB_HOST=db
      - DB_DATABASE=licenses
      - DB_USERNAME=license_user
      - DB_PASSWORD=${DB_PASSWORD}
    depends_on:
      - db

  db:
    image: mysql:8.0
    volumes:
      - mysql_data:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=licenses
      - MYSQL_USER=license_user
      - MYSQL_PASSWORD=${DB_PASSWORD}

volumes:
  mysql_data:
```

---

## Roadmap

### Phase 1 - MVP
- [ ] Lumen Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
- [ ] Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- [ ] API verify
- [ ] Admin CRUD
- [ ] ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ UI

### Phase 2 - Partner Integration
- [ ] Webhook Ğ¾Ñ‚ Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€Ğ°
- [ ] Auto-ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¹
- [ ] Email ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ

### Phase 3 - SIP Wrapper Integration
- [ ] License client Ğ² Python
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ
- [ ] Enforce Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ²
- [ ] UI ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¸

### Phase 4 - Production
- [ ] ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³
- [ ] Backup ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ
- [ ] Rate limiting
- [ ] Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

---

---

## Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° ĞºĞ¾Ğ´Ğ°

### Ğ¤Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ¸Ñ

```
ĞĞµ Ñ‚Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒ 80% Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ½Ğ° Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñƒ Ğ¾Ñ‚ 5% Ğ¿Ğ¸Ñ€Ğ°Ñ‚Ğ¾Ğ²

Ğ¦ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ² ÑĞµÑ€Ğ²Ğ¸ÑĞµ, Ğ½Ğµ Ğ² ĞºĞ¾Ğ´Ğµ:
â”œâ”€â”€ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
â”œâ”€â”€ ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°
â”œâ”€â”€ Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
â”œâ”€â”€ ĞĞ¾Ğ²Ñ‹Ğµ Ñ„Ğ¸Ñ‡Ğ¸
â””â”€â”€ SLA
```

### Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¼ĞµÑ€Ñ‹ (Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ)

| ĞœĞµÑ€Ğ° | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|------|----------|
| License check | ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ + heartbeat 24Ñ‡ |
| Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ID | Ğ˜Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¸Ğ½ÑÑ‚Ğ°Ğ»Ğ»ÑÑ†Ğ¸Ğ¸ |
| Ğ¢ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ñ | Ğ—Ğ½Ğ°ĞµĞ¼ ĞµÑĞ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ Ğ±ĞµĞ· Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¸ |
| Offline Ñ„Ğ°Ğ¹Ğ» | ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ½Ñ‹Ğ¹, Ñ Ğ´Ğ°Ñ‚Ğ¾Ğ¹ Ğ¸ÑÑ‚ĞµÑ‡ĞµĞ½Ğ¸Ñ |

### Docker Ğ¾Ğ±Ñ€Ğ°Ğ·

```
Docker = ÑƒĞ´Ğ¾Ğ±ÑÑ‚Ğ²Ğ¾ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸, ĞĞ• Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°
ĞšĞ¾Ğ´ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚ÑŒ Ğ¸Ğ· Ğ»ÑĞ±Ğ¾Ğ³Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ°
ĞŸÑ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµĞ¼ ÑÑ‚Ğ¾ ĞºĞ°Ğº Ñ„Ğ°ĞºÑ‚
```

### Ğ’Ñ‹Ğ²Ğ¾Ğ´

ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹ license check Ğ´Ğ»Ñ Ñ‡ĞµÑÑ‚Ğ½Ñ‹Ñ… ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ².
ĞŸĞ¸Ñ€Ğ°Ñ‚Ñ‹ Ğ²ÑÑ‘ Ñ€Ğ°Ğ²Ğ½Ğ¾ Ğ½Ğµ Ğ·Ğ°Ğ¿Ğ»Ğ°Ñ‚ÑÑ‚ - Ğ½Ğµ Ñ‚Ñ€Ğ°Ñ‚Ğ¸Ğ¼ Ğ²Ñ€ĞµĞ¼Ñ.

---

## Ğ”Ğ¸ÑÑ‚Ñ€Ğ¸Ğ±ÑƒÑ†Ğ¸Ñ Docker Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ°

### Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ

**Ğ­Ñ‚Ğ°Ğ¿ 1 (ÑĞµĞ¹Ñ‡Ğ°Ñ): Self-hosted**
```
ĞšĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚:
â”œâ”€â”€ Ğ›Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ (LICENSE_KEY)
â”œâ”€â”€ Docker Ğ¾Ğ±Ñ€Ğ°Ğ· (pull)
â””â”€â”€ Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

ĞšĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞ°Ğ¼ ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ Ğ½Ğ° ÑĞ²Ğ¾Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€
```

**Ğ­Ñ‚Ğ°Ğ¿ 2 (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ): Managed SaaS**
```
Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ¿Ñ†Ğ¸Ñ:
â”œâ”€â”€ ĞœÑ‹ Ñ…Ğ¾ÑÑ‚Ğ¸Ğ¼ ÑĞµÑ€Ğ²ĞµÑ€ Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°
â”œâ”€â”€ +50-100â‚¬/Ğ¼ĞµÑ Ğº Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¸
â””â”€â”€ Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ñ…Ğ¾ÑÑ‚Ğ¸Ğ½Ğ³ + Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° + SLA
```

### Docker Registry

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: GitHub Container Registry (GHCR)**

```
ghcr.io/insidedynamic-de/sip-wrapper:latest
ghcr.io/insidedynamic-de/sip-wrapper:1.0.0
```

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ GHCR:**
- Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
- ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹
- Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ GitHub Actions (CI/CD)
- Ğ¢Ğ¾ĞºĞµĞ½Ñ‹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²
- ĞĞµÑ‚ pull limits

### Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²

```bash
# ĞšĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½ Ğ¸ Ğ´ĞµĞ»Ğ°ĞµÑ‚:
echo $REGISTRY_TOKEN | docker login ghcr.io -u client --password-stdin
docker pull ghcr.io/insidedynamic-de/sip-wrapper:1.0.0
```

Ğ¢Ğ¾ĞºĞµĞ½ Ğ²Ñ‹Ğ´Ğ°Ñ‘Ñ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞµ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¸ (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¸Ğ»Ğ¸ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ).

---

## Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ² (TODO)

### Ğ¢Ñ€Ğ°Ğ½ÑĞºĞ¾Ğ´Ğ¸Ğ½Ğ³ - Ğ¾Ğ±ÑŠÑÑĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñƒ

**Ğ§Ñ‚Ğ¾ ÑÑ‚Ğ¾:** ĞšĞ¾Ğ³Ğ´Ğ° SIP ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ ĞºĞ¾Ğ´ĞµĞºĞ¸, FreeSWITCH Ğ¿ĞµÑ€ĞµĞºĞ¾Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸.

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:**
- Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ Ğ½Ğ° CPU (+50-100%)
- ĞœĞ¾Ğ¶ĞµÑ‚ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºÑƒ
- Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² ÑĞµÑ€Ğ²ĞµÑ€Ğ°

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:**
```
VAPI (Opus) â†â†’ FreeSWITCH â†â†’ Placetel (G.711)
= Ğ¢Ñ€Ğ°Ğ½ÑĞºĞ¾Ğ´Ğ¸Ğ½Ğ³ Ğ½ÑƒĞ¶ĞµĞ½, Ğ±Ğ¾Ğ»ÑŒÑˆĞµ CPU

VAPI (G.711) â†â†’ FreeSWITCH â†â†’ Placetel (G.711)
= Ğ‘ĞµĞ· Ñ‚Ñ€Ğ°Ğ½ÑĞºĞ¾Ğ´Ğ¸Ğ½Ğ³Ğ°, Ğ¼ĞµĞ½ÑŒÑˆĞµ CPU
```

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°Ğ¼:**
- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ñ‹Ğµ ĞºĞ¾Ğ´ĞµĞºĞ¸ Ñ Ğ¾Ğ±ĞµĞ¸Ñ… ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½
- Ğ•ÑĞ»Ğ¸ Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ - Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ VM Ñ Ğ·Ğ°Ğ¿Ğ°ÑĞ¾Ğ¼ CPU
- G.711 (PCMU/PCMA) - Ğ½Ğ°Ğ¸Ğ±Ğ¾Ğ»ĞµĞµ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ñ‹Ğ¹

---

## Resource Calculator (TODO)

ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ² - ĞºĞ°ĞºĞ¾Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€ Ğ½ÑƒĞ¶ĞµĞ½.

**Ğ’Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
- ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ·Ğ²Ğ¾Ğ½ĞºĞ¾Ğ²
- ĞÑƒĞ¶ĞµĞ½ Ğ»Ğ¸ Ñ‚Ñ€Ğ°Ğ½ÑĞºĞ¾Ğ´Ğ¸Ğ½Ğ³
- ĞšĞ¾Ğ´ĞµĞºĞ¸

**Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
- CPU (vCPU)
- RAM (GB)
- Bandwidth (Mbps)
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ VM (Hetzner, AWS, DigitalOcean)

**Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²:**

| Calls | CPU | RAM | Bandwidth | +Ğ¢Ñ€Ğ°Ğ½ÑĞºĞ¾Ğ´Ğ¸Ğ½Ğ³ |
|-------|-----|-----|-----------|--------------|
| 10 | 1 vCPU | 1 GB | 10 Mbps | +50% CPU |
| 30 | 1 vCPU | 2 GB | 30 Mbps | +50% CPU |
| 50 | 2 vCPU | 4 GB | 50 Mbps | +50% CPU |
| 100 | 4 vCPU | 8 GB | 100 Mbps | +50% CPU |
| 300 | 8 vCPU | 16 GB | 300 Mbps | +50% CPU |

---

## Ğ¡Ğ¼ĞµĞ½Ğ° IP ÑĞµÑ€Ğ²ĞµÑ€Ğ°

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°

ĞšĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿ĞµÑ€ĞµĞµÑ…Ğ°Ğ» Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€, IP Ğ¿Ğ¾Ğ¼ĞµĞ½ÑĞ»ÑÑ. Ğ¡Ñ‚Ğ°Ñ€Ğ°Ñ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ½Ğ° Ğº ÑÑ‚Ğ°Ñ€Ğ¾Ğ¼Ñƒ IP.

### Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ

**ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ÑĞ¼ĞµĞ½Ğ° Ñ‡ĞµÑ€ĞµĞ· Admin Panel:**

```
ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ:
â”œâ”€â”€ 1 ÑĞ¼ĞµĞ½Ğ° IP Ğ² 30 Ğ´Ğ½ĞµĞ¹ (Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ abuse)
â”œâ”€â”€ Ğ¡Ğ¼ĞµĞ½Ğ° Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²
â””â”€â”€ Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ² Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ
```

### ĞĞ¾Ğ²Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğµ Ğ² `license_packages`

```sql
ALTER TABLE license_packages ADD COLUMN
    last_ip_change DATETIME NULL;
```

### API Endpoint

```
PUT /api/packages/{package_id}/server
```

**Request:**
```json
{
    "license_key": "xxx-xxx-xxx",
    "new_ip": "195.168.1.200",
    "new_hostname": "new-server.example.com"
}
```

**Response (success):**
```json
{
    "success": true,
    "message": "Server IP updated",
    "next_change_allowed": "2025-03-07T00:00:00Z"
}
```

**Response (error - too soon):**
```json
{
    "success": false,
    "error": "ip_change_limit",
    "message": "IP change allowed after 2025-03-07",
    "days_remaining": 15
}
```

### Workflow ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°

```
1. ĞšĞ»Ğ¸ĞµĞ½Ñ‚ ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ SIP Wrapper Ğ½Ğ° Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€
2. ĞŸÑ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ - Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ "IP mismatch"
3. ĞšĞ»Ğ¸ĞµĞ½Ñ‚ Ğ·Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² ÑĞ²Ğ¾Ğ¹ Customer Portal (Ğ¸Ğ»Ğ¸ Admin Panel)
4. ĞĞ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ "Change Server IP"
5. Ğ’Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ IP
6. Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ (1 Ñ€Ğ°Ğ· Ğ² 30 Ğ´Ğ½ĞµĞ¹)
7. Ğ•ÑĞ»Ğ¸ ĞĞš - Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ IP
8. ĞšĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ SIP Wrapper
```

### Ğ˜ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ

```
Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ Ğ½ÑƒĞ¶Ğ½Ğ° ÑÑ€Ğ¾Ñ‡Ğ½Ğ°Ñ ÑĞ¼ĞµĞ½Ğ° (< 30 Ğ´Ğ½ĞµĞ¹):
â”œâ”€â”€ ĞĞ±Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ÑÑ Ğ² Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºÑƒ
â”œâ”€â”€ ĞœÑ‹ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµĞ¼ last_ip_change
â””â”€â”€ Ğ˜Ğ»Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ°ĞºĞµÑ‚, Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹
```

---

## Admin Panel - Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸

### Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dashboard                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Active   â”‚  â”‚ Expiring â”‚  â”‚ Trials   â”‚  â”‚ Revenue  â”‚        â”‚
â”‚  â”‚   42     â”‚  â”‚    5     â”‚  â”‚    8     â”‚  â”‚ 4,230â‚¬   â”‚        â”‚
â”‚  â”‚ licenses â”‚  â”‚  7 days  â”‚  â”‚  active  â”‚  â”‚ /month   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                  â”‚
â”‚  Expiring Soon (7 days)                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Company        â”‚ Package â”‚ Expires   â”‚ Action        â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ Example GmbH   â”‚ Paid 10 â”‚ 3 days    â”‚ [Remind]      â”‚     â”‚
â”‚  â”‚ Demo AG        â”‚ NFR     â”‚ 5 days    â”‚ [Remind]      â”‚     â”‚
â”‚  â”‚ Test Client    â”‚ Trial   â”‚ 7 days    â”‚ [Convert]     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚  Recent Activity                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ 10:45 â”‚ License ABC verified â”‚ 195.168.1.100         â”‚     â”‚
â”‚  â”‚ 10:30 â”‚ New trial created â”‚ test@example.com          â”‚     â”‚
â”‚  â”‚ 10:15 â”‚ IP mismatch attempt â”‚ License XYZ             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Licenses List

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Licenses                                    [+ New License]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Filter: [Allâ–¼] [Activeâ–¼]  Search: [________________] [ğŸ”]     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ License Key      â”‚ Customer    â”‚ Packages â”‚ Status     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ ABC-DEF-123...   â”‚ Example GmbHâ”‚ 3 active â”‚ â— Active   â”‚   â”‚
â”‚  â”‚ XYZ-789-456...   â”‚ Demo AG     â”‚ 1 active â”‚ â— Active   â”‚   â”‚
â”‚  â”‚ 111-222-333...   â”‚ Old Client  â”‚ 0 active â”‚ â—‹ Expired  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  [â—€ Prev] Page 1 of 5 [Next â–¶]                                  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### License Detail

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ License: ABC-DEF-123-456-789                   [Edit] [Delete] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Customer Information                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Name:     Max Mustermann                              â”‚     â”‚
â”‚  â”‚ Email:    max@example.com                             â”‚     â”‚
â”‚  â”‚ Company:  Example GmbH                                â”‚     â”‚
â”‚  â”‚ Status:   â— Active                                    â”‚     â”‚
â”‚  â”‚ Created:  2024-01-15                                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚  Packages                                       [+ Add Package] â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Type  â”‚ Conn â”‚ Server         â”‚ Expires    â”‚ Status    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Paid  â”‚  10  â”‚ 195.168.1.100  â”‚ 2025-12-31 â”‚ â— Active  â”‚   â”‚
â”‚  â”‚ Paid  â”‚  10  â”‚ 195.168.1.200  â”‚ 2025-12-31 â”‚ â— Active  â”‚   â”‚
â”‚  â”‚ Trial â”‚   2  â”‚ test.client.de â”‚ 2024-02-01 â”‚ â—‹ Expired â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  Recent Checks (last 24h)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Time  â”‚ Package â”‚ IP            â”‚ Instance  â”‚ Result  â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ 10:45 â”‚ Paid #1 â”‚ 195.168.1.100 â”‚ abc-123   â”‚ âœ“ Valid â”‚     â”‚
â”‚  â”‚ 10:30 â”‚ Paid #2 â”‚ 195.168.1.200 â”‚ def-456   â”‚ âœ“ Valid â”‚     â”‚
â”‚  â”‚ 09:15 â”‚ Paid #1 â”‚ 10.0.0.50     â”‚ xyz-789   â”‚ âœ— IP    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚  Actions                                                         â”‚
â”‚  [Suspend License] [Send Reminder] [View Full History]          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Create/Edit Package

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Add Package to License: ABC-DEF-123                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Package Type                                                    â”‚
â”‚  (â—) Paid     ( ) Trial     ( ) NFR                             â”‚
â”‚                                                                  â”‚
â”‚  Connections                                                     â”‚
â”‚  [10    â–¼] (10, 20, 30, 50, 100)                                â”‚
â”‚                                                                  â”‚
â”‚  Server Binding                                                  â”‚
â”‚  IP:       [195.168.1.100        ]                              â”‚
â”‚  Hostname: [server.example.com   ] (optional)                   â”‚
â”‚                                                                  â”‚
â”‚  Duration                                                        â”‚
â”‚  (â—) 12 months - 149â‚¬/mo     Total: 1,788â‚¬                      â”‚
â”‚  ( ) 24 months - 119â‚¬/mo     Total: 2,856â‚¬                      â”‚
â”‚  ( ) 36 months - 99â‚¬/mo      Total: 3,564â‚¬                      â”‚
â”‚                                                                  â”‚
â”‚  Partner Order ID                                                â”‚
â”‚  [PARTNER-12345         ] (for reference)                       â”‚
â”‚                                                                  â”‚
â”‚  Notes                                                           â”‚
â”‚  [________________________________]                              â”‚
â”‚                                                                  â”‚
â”‚                              [Cancel]  [Create Package]          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Settings

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Settings                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Webhook Configuration                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Webhook Secret: [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢] [Show] [Regen]  â”‚     â”‚
â”‚  â”‚ Webhook URL: https://license.example.com/webhook/orderâ”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚  Email Configuration                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ SMTP Host:     [smtp.example.com        ]            â”‚     â”‚
â”‚  â”‚ SMTP Port:     [587                     ]            â”‚     â”‚
â”‚  â”‚ SMTP User:     [noreply@example.com     ]            â”‚     â”‚
â”‚  â”‚ SMTP Password: [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢          ]            â”‚     â”‚
â”‚  â”‚ From Name:     [SIP Wrapper License     ]            â”‚     â”‚
â”‚  â”‚ From Email:    [license@example.com     ]            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚  Notification Settings                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ [âœ“] Send email on license creation                    â”‚     â”‚
â”‚  â”‚ [âœ“] Send reminder 7 days before expiry                â”‚     â”‚
â”‚  â”‚ [âœ“] Send reminder 3 days before expiry                â”‚     â”‚
â”‚  â”‚ [âœ“] Send notification on expiry                       â”‚     â”‚
â”‚  â”‚ [âœ“] Send admin alert on suspicious activity           â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚                                           [Save Settings]        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Webhook Ğ¾Ñ‚ Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€Ğ° - Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚

### Endpoint

```
POST /webhook/order
Content-Type: application/json
X-Webhook-Signature: sha256=xxxxxx
X-Webhook-Timestamp: 1707148800
```

### ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑŒ

```php
$timestamp = $_SERVER['HTTP_X_WEBHOOK_TIMESTAMP'];
$payload = file_get_contents('php://input');
$signature = hash_hmac('sha256', $timestamp . '.' . $payload, $secret);

// ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°
$expected = $_SERVER['HTTP_X_WEBHOOK_SIGNATURE'];
if (!hash_equals('sha256=' . $signature, $expected)) {
    return response()->json(['error' => 'invalid_signature'], 401);
}

// Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ replay (5 Ğ¼Ğ¸Ğ½ÑƒÑ‚)
if (abs(time() - $timestamp) > 300) {
    return response()->json(['error' => 'expired_request'], 401);
}
```

### Webhook: ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°ĞºĞ°Ğ·

**Request:**
```json
{
    "event": "order.created",
    "order_id": "PARTNER-12345",
    "timestamp": "2025-02-05T10:00:00Z",
    "customer": {
        "name": "Max Mustermann",
        "email": "max@example.com",
        "company": "Example GmbH",
        "phone": "+49123456789"
    },
    "package": {
        "type": "paid",
        "connections": 10,
        "duration_months": 36,
        "server_ip": "195.168.1.100",
        "server_hostname": "server.example.com"
    },
    "billing": {
        "price_cents": 9900,
        "currency": "EUR",
        "cycle": "monthly"
    }
}
```

**Response (success):**
```json
{
    "success": true,
    "license_key": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
    "package_id": 123,
    "starts_at": "2025-02-05T00:00:00Z",
    "expires_at": "2028-02-05T00:00:00Z",
    "message": "License created successfully"
}
```

**Response (error):**
```json
{
    "success": false,
    "error": "validation_failed",
    "message": "Invalid server IP format",
    "details": {
        "field": "package.server_ip",
        "value": "invalid-ip"
    }
}
```

### Webhook: Trial Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ

**Request:**
```json
{
    "event": "trial.requested",
    "order_id": "TRIAL-67890",
    "timestamp": "2025-02-05T10:00:00Z",
    "customer": {
        "name": "Test User",
        "email": "test@example.com",
        "company": "Test GmbH"
    },
    "package": {
        "type": "trial",
        "connections": 2,
        "duration_days": 14,
        "server_ip": "10.0.0.50"
    }
}
```

**Response (error - already has trial):**
```json
{
    "success": false,
    "error": "trial_limit_exceeded",
    "message": "Customer already has an active or expired trial",
    "existing_trial": {
        "created_at": "2025-01-15T00:00:00Z",
        "status": "expired"
    }
}
```

### Webhook: ĞŸÑ€Ğ¾Ğ´Ğ»ĞµĞ½Ğ¸Ğµ

**Request:**
```json
{
    "event": "order.renewed",
    "order_id": "PARTNER-12345-R1",
    "timestamp": "2025-02-05T10:00:00Z",
    "original_order_id": "PARTNER-12345",
    "package_id": 123,
    "extension_months": 12,
    "billing": {
        "price_cents": 14900,
        "currency": "EUR",
        "cycle": "monthly"
    }
}
```

### Webhook: ĞÑ‚Ğ¼ĞµĞ½Ğ°

**Request:**
```json
{
    "event": "order.cancelled",
    "order_id": "PARTNER-12345",
    "timestamp": "2025-02-05T10:00:00Z",
    "package_id": 123,
    "reason": "customer_request",
    "cancel_at": "2025-02-28T23:59:59Z"
}
```

### Webhook Events

| Event | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ |
|-------|----------|----------|
| `order.created` | ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°ĞºĞ°Ğ· | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ license + package |
| `trial.requested` | Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ trial | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ trial (ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚) |
| `order.renewed` | ĞŸÑ€Ğ¾Ğ´Ğ»ĞµĞ½Ğ¸Ğµ | Extend expires_at |
| `order.cancelled` | ĞÑ‚Ğ¼ĞµĞ½Ğ° | Set status=cancelled |
| `order.upgraded` | Upgrade | Add connections |

---

## Email ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ

### Ğ¢Ğ¸Ğ¿Ñ‹ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹

| Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ | ĞšĞ¾Ğ¼Ñƒ | ĞšĞ¾Ğ³Ğ´Ğ° |
|---------|------|-------|
| License Created | ĞšĞ»Ğ¸ĞµĞ½Ñ‚ | Ğ¡Ñ€Ğ°Ğ·Ñƒ |
| Trial Started | ĞšĞ»Ğ¸ĞµĞ½Ñ‚ | Ğ¡Ñ€Ğ°Ğ·Ñƒ |
| Expiring Soon | ĞšĞ»Ğ¸ĞµĞ½Ñ‚ | 7 Ğ´Ğ½ĞµĞ¹, 3 Ğ´Ğ½Ñ, 1 Ğ´ĞµĞ½ÑŒ |
| License Expired | ĞšĞ»Ğ¸ĞµĞ½Ñ‚ | Ğ’ Ğ´ĞµĞ½ÑŒ Ğ¸ÑÑ‚ĞµÑ‡ĞµĞ½Ğ¸Ñ |
| Suspicious Activity | Admin | ĞŸÑ€Ğ¸ Ğ´ĞµÑ‚ĞµĞºÑ†Ğ¸Ğ¸ |
| IP Change | ĞšĞ»Ğ¸ĞµĞ½Ñ‚ | ĞŸĞ¾ÑĞ»Ğµ ÑĞ¼ĞµĞ½Ñ‹ |

### Email: License Created

**Subject:** Your SIP Wrapper License is Ready

```
Hello Max,

Your SIP Wrapper license has been activated.

License Details:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
License Key:  ABC-DEF-123-456-789
Package:      Paid (10 connections)
Server:       195.168.1.100
Expires:      February 5, 2028
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Quick Start:
1. Pull the Docker image
2. Set LICENSE_KEY in your docker-compose.yml
3. Start the container

Documentation: https://docs.example.com/sip-wrapper

Need help? Contact support@example.com

Best regards,
SIP Wrapper Team
```

### Email: Trial Started

**Subject:** Your 14-Day SIP Wrapper Trial

```
Hello,

Your free trial of SIP Wrapper is now active.

Trial Details:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
License Key:  XYZ-789-456-...
Connections:  2 (for testing)
Expires:      February 19, 2025 (14 days)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

What you can do:
âœ“ Connect 2 SIP trunks
âœ“ Test inbound and outbound calls
âœ“ Try all features

Getting Started Guide: https://docs.example.com/quickstart

Questions? Reply to this email.

Best regards,
SIP Wrapper Team
```

### Email: Expiring Soon (7 days)

**Subject:** âš ï¸ Your SIP Wrapper License Expires in 7 Days

```
Hello Max,

Your SIP Wrapper license will expire in 7 days.

License Details:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
License Key:  ABC-DEF-123-456-789
Package:      Paid (10 connections)
Expires:      February 12, 2025
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸ After expiration:
â€¢ New calls will be blocked
â€¢ Existing calls will continue until completion
â€¢ Configuration will be preserved

To renew your license, contact your account manager
or visit: https://portal.example.com/renew

Best regards,
SIP Wrapper Team
```

### Email: Expiring Soon (1 day)

**Subject:** ğŸš¨ URGENT: SIP Wrapper License Expires Tomorrow

```
Hello Max,

Your SIP Wrapper license expires TOMORROW.

License: ABC-DEF-123-456-789
Expires: February 6, 2025 (1 day)

âš ï¸ ACTION REQUIRED
Renew now to avoid service interruption.

[Renew License] â†’ https://portal.example.com/renew

Need help? Call: +49 123 456 789

Best regards,
SIP Wrapper Team
```

### Email: License Expired

**Subject:** ğŸ”´ Your SIP Wrapper License Has Expired

```
Hello Max,

Your SIP Wrapper license has expired.

License: ABC-DEF-123-456-789
Expired: February 5, 2025

Current Status:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âŒ New calls: BLOCKED
âœ“  Active calls: Will complete
âœ“  Configuration: Preserved for 30 days
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

To restore service:
1. Renew your license
2. Restart the SIP Wrapper container

[Renew Now] â†’ https://portal.example.com/renew

Your configuration will be preserved for 30 days.
After that, you'll need to reconfigure.

Best regards,
SIP Wrapper Team
```

### Email: IP Changed

**Subject:** âœ“ Server IP Updated for Your SIP Wrapper License

```
Hello Max,

The server IP for your SIP Wrapper license has been updated.

Change Details:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Old IP:     195.168.1.100
New IP:     195.168.1.200
Changed:    February 5, 2025
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Note: You can change IP again after March 7, 2025.

If you didn't make this change, contact us immediately.

Best regards,
SIP Wrapper Team
```

### Email: Suspicious Activity (Admin)

**Subject:** ğŸš¨ Alert: Suspicious License Activity Detected

```
ALERT: Suspicious activity for license ABC-DEF-123

Details:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Type:       Instance mismatch
License:    ABC-DEF-123-456-789
Expected:   instance-abc-123
Got:        instance-xyz-789
IP:         10.0.0.50
Time:       2025-02-05 10:45:00 UTC
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Possible causes:
â€¢ VM was cloned
â€¢ License shared between servers
â€¢ Container recreated without volume

Recent attempts (last 24h):
â€¢ 15 failed: instance_mismatch
â€¢ 3 failed: ip_mismatch

[View Details] â†’ https://admin.example.com/licenses/123

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
This is an automated alert from License Server.
```

### Cron Job Ğ´Ğ»Ñ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹

```php
// app/Console/Commands/SendExpirationReminders.php

// Ğ—Ğ°Ğ¿ÑƒÑĞº ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾ Ğ² 09:00 UTC
// * 9 * * * php artisan licenses:remind

public function handle()
{
    // 7 Ğ´Ğ½ĞµĞ¹ Ğ´Ğ¾ Ğ¸ÑÑ‚ĞµÑ‡ĞµĞ½Ğ¸Ñ
    $expiring7days = Package::where('status', 'active')
        ->whereDate('expires_at', Carbon::now()->addDays(7))
        ->get();

    foreach ($expiring7days as $package) {
        Mail::to($package->license->customer_email)
            ->send(new ExpirationReminder($package, 7));
    }

    // 3 Ğ´Ğ½Ñ Ğ´Ğ¾ Ğ¸ÑÑ‚ĞµÑ‡ĞµĞ½Ğ¸Ñ
    $expiring3days = Package::where('status', 'active')
        ->whereDate('expires_at', Carbon::now()->addDays(3))
        ->get();

    // ... Ğ¸ Ñ‚.Ğ´.
}
```

---

## Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹ `license-server`
2. Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Lumen Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
3. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
4. Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ API verify
5. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ admin panel
6. Deploy Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€
7. Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² SIP Wrapper
8. Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ: Ñ‚Ñ€Ğ°Ğ½ÑĞºĞ¾Ğ´Ğ¸Ğ½Ğ³
9. Resource Calculator Ğ½Ğ° landing
